
import numpy as np
import PIL.Image as Image

def imagefile_to_array(image_path):
    """
    Loads image into 3D Numpy array of shape 
    (width, height, channels)
    """
    with Image.open(image_path) as image:         
        im_arr = np.fromstring(image.tobytes(), dtype=np.uint8)
        rows   = image.size[1]
        cols   = image.size[0]
        no_channels = len(im_arr)/rows/cols
        im_arr = im_arr.reshape((rows, cols, no_channels))
        im_arr = np.rollaxis(im_arr,-1)
    return im_arr

def array_to_imagefile(data, imagefname):
    """
    gets a 3D Numpy array of shape 
    (width, height, channels)
    and saves ist into imagefname
    """
    img = Image.fromarray(np.rollaxis(np.rollaxis(data,-1),-1))
    img.save(imagefname)
    return 1
