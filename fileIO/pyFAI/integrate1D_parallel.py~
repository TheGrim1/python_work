
# global imports
from multiprocessing import Pool
import sys, os
import matplotlib.pyplot as plt
import time
import h5py
import numpy as np
import json

# local imports
sys.path.append(os.path.abspath("/data/id13/inhouse2/AJ/skript"))
from simplecalc.slicing import troi_to_slice

def task(inargs):
               
    fname      = inargs[0]
    group      = 'entry/data/' + inargs[1]
    slice_list = inargs[2]
    
    print "doing: group %s in process %s" % (group,os.getpid())
    f = h5py.File(fname,'r')

    noframes = f[group].shape[0]
    print 'number of frames = %s' % noframes
    
    result = np.zeros(shape = (len(slice_list),noframes))
    
    for frame in range(noframes):
        print 'dataset %s, frame %s of %s' % (group, frame, noframes)
        for sl_no, sl in enumerate(slice_list):
            data = f[group][frame][sl]
            result[sl_no, frame] = data.sum()
            #print data.sum()
    f.close()

    return result
