# local directory 
import fileIO.hdf5.h5_scan as h5
import fileIO.hdf5.h5_tools as tools
import matplotlib.pyplot as plt
import numpy as np
import copy


# get data:
fname = '/data/id13/inhouse6/THEDATA_I6_1/d_2016-11-17_inh_ihsc1404/PROCESS/SESSION23/integrated/AJ2c_af/AJ2c_after_T1byzth_156_225_integrated.h5'

iq = tools.open_full_dataset(fname, 'i_over_q')

maxiq = np.max(np.max(iq, axis = 0),axis=-1)
maxiq.shape
# plt.plot(maxiq[0],maxiq[1])
# plt.show()

maxid    = copy.copy(maxiq) 
maxid[0] = 2*math.pi/maxid[0]
maxid[0] = 10*maxid[0]

id = copy.copy(iq)
id[:,0,:,:] = 20*math.pi/id[:,0,:,:]
# plt.plot(maxid[0],maxid[1])
# plt.show()

# general setup

fig = plt.figure()
ax1 = fig.add_subplot(1,1,1,axisbg = (0.9, 0.9, 0.95))
ax1.figure.set_size_inches(12,5)
plt.subplots_adjust(bottom=0.25)
plt.subplots_adjust(left=0.25)
#plt.tight_layout()

# labels
ax1.set_xlabel('d-spacing [nm]')
ax1.set_ylabel('intensity [norm.]')

# extra lines
# xv1       = [1.595,1.60,1.615,1.635]
# colorlist = ['black','red','green','blue']
# for i,xline in enumerate(xv1):
#     plt.axvline(xline,color=colorlist[i], linestyle='solid',linewidth = 1)

# colored areas
xv1       = [[1.615,1.630],[1.605,1.615],[1.590,1.605]]
colorlist = ['red','green','blue']
for i,lims in enumerate(xv1):
    plt.axvspan(lims[0], lims[1], facecolor=colorlist[i], alpha=0.5)

# fine tuneing:
plt.locator_params(axis = 'x', nbins = 6)
plt.locator_params(axis = 'y', nbins = 4)

for item in ([ax1.title, ax1.xaxis.label, ax1.yaxis.label] +
             ax1.get_xticklabels() + ax1.get_yticklabels()):
    item.set_fontsize(36)

# invert x axis
ax1.invert_xaxis()


# select data
# range=[i for i,x in enumerate(maxid[0]) if (x < 1.63) and (x > 1.59)]
# ax1.plot(maxid[0][range],maxid[1][range], linewidth = 1.5, color ='black')
# fig.savefig('/tmp_14_days/johannes1/T1b_12_max.png',transparent = True)

# plot frame over id
frameno = 787
range=[i for i,x in enumerate(maxid[0]) if (x < 1.63) and (x > 1.59)]
ax1.plot(id[12,0,:,frameno][range],id[12,1,:,frameno][range]/np.max(id[12,1,:,frameno][range]), linewidth = 1.5, color ='black')
fig.savefig('/tmp_14_days/johannes1/T1b_12_%s_norm.png' % frameno,transparent = True)


fig.show()
