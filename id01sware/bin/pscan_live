#!/usr/bin/env python
#raise Exception("Needs Testing...!")
# built-in:
import sys
#sys.path.append("/users/blissadm/python/bliss_modules/") # this line should be removed later
import time
import thread


# community:
import numpy as np
import matplotlib.pyplot as pl
from SpecClient import SpecVariable
#from SpecClient import SpecCommand

try:
    from id01lib import PScanTracker
except ImportError:
    print("trying local import.")
    sys.path.append(os.path.join(os.path.abspath(os.pardir)))
    from id01lib import PScanTracker


def thread1(threadName,tracker):
    """
        Outsource the live update
    """
    count=0
    while count<1000:
        time.sleep(3.)
        tracker.reload()


specname = "nano2:psic_nano"


# need 3 variables, limaroi, scalers and counters
limaroi = SpecVariable.SpecVariable('LIMA_ROI',specname)
pscan_vars = SpecVariable.SpecVariable("PSCAN_ARR",specname)
pscan_data = SpecVariable.SpecVariable('PSCAN_ROICOUNTER_DATA',specname)



fig = pl.figure()
ax = fig.add_subplot(111)
tracker = PScanTracker.PScanTracker(ax, pscan_vars, pscan_data, limaroi)

try:
    thread.start_new_thread(thread1,('thread-1',tracker))
except Exception as emsg:
    print("Error: %s"%emsg)

pl.show()