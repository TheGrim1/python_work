import numpy as np
import scipy.ndimage as nd
from silx.image import sift

# setup a pair of arrays to test alignment
x         = np.atleast_2d(np.arange(100))
y         = np.atleast_2d(np.arange(100)).T
shift     = (5,15)
reference = ((x-50))**2 * ((y-50))**2
reference[50:55,50:55] = 500000
align     = nd.shift(reference,shift)
    
# initialize sift according to mail from Pierre Paleo
alignplan = sift.LinearAlign(reference, devicetype="GPU")
# alternative: alignplan = sift.LinearAlign(reference, device=(2,0))

# devicetype = "GPU" -->> continues
# devicetype = "CPU" -->> Segmentation fault

test = alignplan.align(align,shift_only = True, return_all=True)
shift = np.trunc(test['offset'])
